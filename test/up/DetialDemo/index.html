<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Ajax无刷新上传示例程序--返回文件详细信息</title>
    <script type="text/javascript" src="js/AnPlus.js"></script>
    <script type="text/javascript" src="js/AjaxUploader.js"></script>
</head>
<body style="font-size:12px;">
<br />
本例演示上传一个文件到指定文件夹，并且返回文件的地址,并显示到文本框<br /><br />
通过下拉框可以选择文件保存的目录
<hr />
附件:<input type="text" name="fj1" id="fj1" size="30" />
<input type="button" value="上传附件" onclick="showUploader('fj1',this);" /><br />
<div id="detialMsg" style ="padding:5px;border:1px #ddd solid;background-color:#eee;width:300px;margin:5px;"></div>
<div id="uploadContenter" style="background-color:#eeeeee;position:absolute;border:1px #555555 solid;padding:3px;"></div>
<iframe style="display:none;" name="AnUploader"></iframe>
<script type="text/javascript">
	/*======================================
	下面语句使上传控件显示在上面ID为uploadContenter的Div标签
	提交URL为upload.asp保存目录为upload
	表单提交到上面name属性为AnUploader的iframe里面；
	========================================*/
	
	var AjaxUp=new AjaxProcesser("uploadContenter");
	
	//设置提交到的iframe名称
	AjaxUp.target="AnUploader";  
	
	//上传处理页面,尽量不要更改
	AjaxUp.url="upload.asp"; 
	
	//保存目录
	AjaxUp.savePath="files";
	
	var contenter=document.getElementById("uploadContenter");
	contenter.style.display="none"; //隐藏容器
	
	function showUploader(objID,srcElement){
		AjaxUp.reset();  //重置上传控件
		contenter.style.display="block"; //显示容器
		var ps=_.abs(srcElement);//作用--获取指定标签的绝对坐标,目的是为了把上传控件定位到按钮下面
		contenter.style.top=(ps.y + 20) + "px";  
		contenter.style.left=ps.x + "px";
		//上传成功时要执行的程序
		AjaxUp.succeed=function(files){
		    var fujian=document.getElementById(objID);
			fujian.value=AjaxUp.savePath + "/" + files[0].name;  //因为上传控件就只上传一个 文件，这里索引是0
			contenter.style.display="none";
			Ai("detialMsg").html("文件名:" + files[0].name + "<br />文件大小:" + files[0].size + "字节<br />原文件名:" + files[0].LocalName + "<br />新文件名:" + files[0].NewName + "");
		}
		//上传失败时要执行的程序
		AjaxUp.faild=function(msg){alert("失败原因:" + msg);contenter.style.display="none";}
	}
</script>
<div id="msgs"></div>
</body>
</html>
